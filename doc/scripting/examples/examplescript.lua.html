<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>MeshUp Lua API</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>MeshUp</h1>




<h2>Examples</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><strong>examplescript.lua</strong></li>
</ul>
<h2>Modules</h2>
<ul class="$(kind=='Topics' and '' or 'nowrap'">
  <li><a href="../index.html">meshup</a></li>
</ul>

</div>

<div id="content">

    <h2>examplescript.lua</h2>
<pre>
<span class="comment">--[[
-- Example for the Lua scripting within MeshUp
--
-- Run this using
--   meshup somemodel.lua -s examplescript.lua
--
-- This script creates a dummy animation that gets updated at every
-- timestep. All degrees of freedom of the model are set to some sinusoidal
-- values to make the model move funnily.
--
-- Please note that the model must have its degrees of freedom specified in
-- its Frame Information Table (see doc/FormatDescriptions.html for more
-- information).
--]]</span>
<span class="keyword">local</span> dof_count = <span class="number">0</span>
<span class="keyword">local</span> animation = {}
<span class="keyword">local</span> model = {}
<span class="keyword">local</span> current_time = <span class="number">0</span>

<span class="keyword">function</span> meshup.<span class="global">load</span> (args)
	<span class="comment">-- arguments that were passed after -s &lt;scriptfile.lua&gt;
</span>	<span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="global">ipairs</span> (args) <span class="keyword">do</span>
		<span class="global">print</span> (k,v)
	<span class="keyword">end</span>

	<span class="global">print</span> (<span class="string">"Load: There are "</span>, meshup.getModelCount(), <span class="string">" models loaded"</span>)
	<span class="global">print</span> (<span class="string">"Load: There are "</span>, meshup.getAnimationCount(), <span class="string">" animations loaded"</span>)

	model = meshup.getModel()
	dof_count = model:getDofCount()

	<span class="global">print</span> (<span class="global">string</span>.format (<span class="string">"model has %d dofs"</span>, dof_count))

	<span class="comment">--[[
	-- create a new animation from script and initialize all values with 0.
	-- Note that the first entry of values corresponds to the time of the
	-- keyframe. We therefore need dof_count + 1 values.
	--]]</span>
	animation = meshup.newAnimation ()
	<span class="keyword">local</span> animation_values = {}
	<span class="keyword">for</span> i=<span class="number">1</span>,dof_count + <span class="number">1</span> <span class="keyword">do</span>
		animation_values[i] = <span class="number">0.</span>
	<span class="keyword">end</span>
	animation:addValues (animation_values)

	r,c = animation:getRawDimensions()
	<span class="global">print</span> (<span class="global">string</span>.format (<span class="string">"animation %s has size %d, %d"</span>, animation:getFilename(), r, c))

	<span class="global">print</span> (<span class="global">string</span>.format (<span class="string">"there are %d models and %d animations loaded"</span>, meshup.getModelCount(), meshup.getAnimationCount()))
<span class="keyword">end</span>

<span class="keyword">function</span> meshup.update (dt)
	current_time = current_time + dt

	<span class="comment">--[[
	-- Here we simply overwrite all values at the first entry of the animation
	-- The time value is still 0 and we only overwrite values of index &gt; 4 with
	-- some sine values just for demonstration purposes
	--]]</span>
	<span class="keyword">local</span> animation_values = {}
	<span class="keyword">for</span> i=<span class="number">1</span>,dof_count + <span class="number">1</span> <span class="keyword">do</span>
		<span class="keyword">if</span> i &gt; <span class="number">4</span> <span class="keyword">then</span>
			animation_values[i] = <span class="global">math</span>.sin (current_time * <span class="number">0.01</span>) * <span class="number">180.</span> / <span class="global">math</span>.pi
		<span class="keyword">else</span>
			animation_values[i] = <span class="number">0.</span>
		<span class="keyword">end</span>
	<span class="keyword">end</span>

	animation:setValuesAt (<span class="number">1</span>, animation_values)
<span class="keyword">end</span></pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.3</a></i>
<i style="float:right;">Last updated 2015-01-14 15:56:51 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
